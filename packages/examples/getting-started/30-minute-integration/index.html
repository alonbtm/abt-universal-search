<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Search - 30 Minute Integration</title>
    <meta name="description" content="Complete Universal Search integration with multiple data sources, custom styling, and advanced features">
    
    <!-- Tailwind CSS (compiled) -->
    <link href="./dist/styles/output.css" rel="stylesheet">
    
    <!-- Fallback styles for development -->
    <style>
        /* Minimal fallback styles if Tailwind hasn't been compiled yet */
        .fallback-loading {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
        }
        
        .fallback-loading.show {
            display: flex;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-fallback {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 0.5rem;
            border-left: 4px solid #dc3545;
        }
        
        .error-fallback h1 {
            color: #dc3545;
            margin-bottom: 1rem;
        }
        
        .error-fallback p {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .error-fallback pre {
            background: #e9ecef;
            padding: 1rem;
            border-radius: 0.25rem;
            overflow-x: auto;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }

        /* Hide content until fully loaded */
        .pre-load {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        
        .loaded {
            opacity: 1;
        }
    </style>
</head>
<body class="pre-load">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fallback-loading show">
        <div class="spinner"></div>
        <h2>Loading Universal Search Integration...</h2>
        <p>Setting up data sources and initializing components</p>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="min-h-screen">
        <!-- Content will be dynamically inserted here by the application -->
        
        <!-- Fallback content for when JavaScript fails -->
        <noscript>
            <div class="error-fallback">
                <h1>JavaScript Required</h1>
                <p>
                    This Universal Search integration example requires JavaScript to function properly. 
                    Please enable JavaScript in your browser and reload the page.
                </p>
                <p>
                    <strong>What you're missing:</strong>
                </p>
                <ul style="margin-left: 2rem; color: #6c757d;">
                    <li>Interactive search with multiple data sources</li>
                    <li>Real-time performance metrics</li>
                    <li>Advanced filtering and configuration options</li>
                    <li>Custom theming and responsive design</li>
                </ul>
            </div>
        </noscript>
    </div>

    <!-- Error Boundary Fallback (hidden by default) -->
    <div id="error-fallback" class="error-fallback" style="display: none;">
        <h1>‚ö†Ô∏è Application Error</h1>
        <p>
            The Universal Search application encountered an unexpected error during initialization. 
            This typically happens when:
        </p>
        <ul style="margin-left: 2rem; color: #6c757d;">
            <li>Dependencies haven't been built properly</li>
            <li>Network connections to data sources fail</li>
            <li>Browser compatibility issues</li>
        </ul>
        
        <h3>Quick Fixes:</h3>
        <ol style="margin-left: 2rem; color: #6c757d;">
            <li><strong>Build the project:</strong> Run <code>npm run build</code> in your terminal</li>
            <li><strong>Start dev server:</strong> Run <code>npm run dev</code> for development mode</li>
            <li><strong>Check console:</strong> Open browser dev tools (F12) for detailed error information</li>
            <li><strong>Refresh page:</strong> Sometimes a simple refresh resolves temporary issues</li>
        </ol>
        
        <div style="margin-top: 2rem;">
            <button id="retry-init" class="btn-primary">üîÑ Retry Initialization</button>
            <a href="../5-minute-setup/" class="btn-primary" style="margin-left: 1rem;">‚Üê Back to 5-Minute Setup</a>
        </div>
        
        <details style="margin-top: 2rem;">
            <summary style="cursor: pointer; color: #007bff;">Show Technical Details</summary>
            <pre id="error-details" style="margin-top: 1rem;">No error details available</pre>
        </details>
    </div>

    <!-- Development Tools Panel (hidden in production) -->
    <div id="dev-tools" class="fixed bottom-4 left-4 bg-gray-800 text-white p-3 rounded-lg text-sm" style="display: none; z-index: 1000;">
        <div class="font-bold mb-2">üõ†Ô∏è Dev Tools</div>
        <div id="dev-info">
            <div>Build Status: <span id="build-status" class="text-yellow-300">Unknown</span></div>
            <div>Sources: <span id="source-count">0</span></div>
            <div>Cache: <span id="cache-count">0</span></div>
        </div>
        <button id="toggle-debug" class="mt-2 px-2 py-1 bg-blue-600 rounded text-xs">Toggle Debug</button>
    </div>

    <!-- Feature Tour Overlay (for first-time visitors) -->
    <div id="feature-tour" class="fixed inset-0 bg-black bg-opacity-50 z-50" style="display: none;">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full p-6">
                <h2 class="text-2xl font-bold mb-4">üöÄ Welcome to 30-Minute Integration!</h2>
                <p class="text-gray-600 mb-6">
                    This example demonstrates a complete Universal Search implementation with 
                    multiple data sources, advanced features, and production-ready patterns.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-blue-50 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">üåê Multi-Source Search</h3>
                        <p class="text-sm text-blue-600">
                            Search across APIs, databases, DOM content, and in-memory data simultaneously
                        </p>
                    </div>
                    <div class="p-4 bg-green-50 rounded-lg">
                        <h3 class="font-semibold text-green-800 mb-2">‚ö° Performance Optimized</h3>
                        <p class="text-sm text-green-600">
                            Intelligent caching, debouncing, and virtual scrolling for optimal speed
                        </p>
                    </div>
                    <div class="p-4 bg-purple-50 rounded-lg">
                        <h3 class="font-semibold text-purple-800 mb-2">üé® Custom Styling</h3>
                        <p class="text-sm text-purple-600">
                            Tailwind CSS integration with dark mode and responsive design
                        </p>
                    </div>
                    <div class="p-4 bg-orange-50 rounded-lg">
                        <h3 class="font-semibold text-orange-800 mb-2">üîß Advanced Config</h3>
                        <p class="text-sm text-orange-600">
                            Real-time configuration, error handling, and performance monitoring
                        </p>
                    </div>
                </div>
                
                <div class="flex justify-between items-center">
                    <label class="flex items-center text-sm text-gray-500">
                        <input type="checkbox" id="dont-show-tour" class="mr-2">
                        Don't show this again
                    </label>
                    <button id="start-tour" class="btn-primary">Start Exploring ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Application Scripts -->
    <!-- Note: In development, make sure to run 'npm run build' first -->
    <script type="module">
        // Global error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            showError('JavaScript Error', event.error?.message || 'Unknown error occurred');
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            showError('Promise Rejection', event.reason?.message || 'Promise was rejected');
        });

        // Show error fallback
        function showError(title, message) {
            document.getElementById('loading-screen').classList.remove('show');
            document.getElementById('app').style.display = 'none';
            
            const errorFallback = document.getElementById('error-fallback');
            const errorDetails = document.getElementById('error-details');
            
            errorFallback.style.display = 'block';
            errorDetails.textContent = `${title}: ${message}\n\nTimestamp: ${new Date().toISOString()}\nUser Agent: ${navigator.userAgent}`;
        }

        // Retry initialization
        document.getElementById('retry-init').addEventListener('click', () => {
            location.reload();
        });

        // Check if we're in development mode
        const isDevelopment = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
        
        if (isDevelopment) {
            document.getElementById('dev-tools').style.display = 'block';
            
            // Update dev info
            function updateDevInfo() {
                document.getElementById('build-status').textContent = 
                    typeof window.UniversalSearchApp !== 'undefined' ? 'Built' : 'Not Built';
            }
            
            updateDevInfo();
            setInterval(updateDevInfo, 2000);
        }

        // Feature tour logic
        function initFeatureTour() {
            const hasSeenTour = localStorage.getItem('universal-search-tour-seen');
            
            if (!hasSeenTour) {
                setTimeout(() => {
                    document.getElementById('feature-tour').style.display = 'block';
                }, 2000);
            }
            
            document.getElementById('start-tour').addEventListener('click', () => {
                const dontShow = document.getElementById('dont-show-tour').checked;
                if (dontShow) {
                    localStorage.setItem('universal-search-tour-seen', 'true');
                }
                document.getElementById('feature-tour').style.display = 'none';
            });
        }

        // Initialize feature tour
        initFeatureTour();

        // Try to load the main application
        try {
            // Import and initialize the main application
            import('./dist/index.js').then(async (module) => {
                try {
                    // Hide loading screen
                    document.getElementById('loading-screen').classList.remove('show');
                    
                    // Show main content
                    document.body.classList.add('loaded');
                    
                    console.log('Universal Search 30-minute integration loaded successfully!');
                    
                    // Update dev tools if available
                    if (isDevelopment && window.dataSourceManager) {
                        setInterval(() => {
                            const sources = window.dataSourceManager?.getDataSources() || [];
                            const cache = window.dataSourceManager?.getCacheStats() || { size: 0 };
                            
                            document.getElementById('source-count').textContent = sources.length;
                            document.getElementById('cache-count').textContent = cache.size;
                        }, 1000);
                    }
                    
                } catch (initError) {
                    throw new Error(`Application initialization failed: ${initError.message}`);
                }
            }).catch((importError) => {
                throw new Error(`Failed to load application module: ${importError.message}`);
            });
            
        } catch (error) {
            showError('Module Loading Error', error.message);
        }

        // Keyboard shortcuts help
        document.addEventListener('keydown', (e) => {
            if (e.key === '?' && (e.ctrlKey || e.metaKey)) {
                alert(`Universal Search Shortcuts:
                
Ctrl/Cmd + K: Focus search
Ctrl/Cmd + /: Focus search  
Escape: Clear search
?: Show this help`);
            }
        });
    </script>

    <!-- Analytics and monitoring (placeholder) -->
    <script>
        // Placeholder for analytics/monitoring code
        // In a real implementation, you might include:
        // - Google Analytics
        // - Application performance monitoring
        // - Error tracking (Sentry, LogRocket, etc.)
        // - User behavior analytics
        
        console.log('üìä Analytics placeholder - add your monitoring code here');
    </script>
</body>
</html>